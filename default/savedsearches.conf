# default/savedsearches.conf
# ThreatER for Splunk App
#
# Purpose:
# - Operational health monitoring
# - Platform health visibility
# - Ingestion validation
# - Alerting primitives
# - Dashboard acceleration support
###############################################################################

############################
# INGESTION HEALTH
############################

[ThreatER Ingestion Health Check]
disabled = 1
alert_type = number
alert_comparator = <
alert_threshold = 1
cron_schedule = */10 * * * *
search = index=security_threater sourcetype=threater:ingestion_health \
| stats latest(status) as status \
| eval healthy=if(status="ok",1,0)
dispatch.earliest_time = -15m
dispatch.latest_time = now
alert.track = 1
description = Triggers if ingestion health reports a non-ok status.

############################
# API CONNECTIVITY / ERRORS
############################

[ThreatER API Errors]
disabled = 1
alert_type = number
alert_comparator = >
alert_threshold = 0
cron_schedule = */5 * * * *
search = index=_internal sourcetype=splunkd component=ModularInputs \
| search ThreatER ERROR OR Exception OR Traceback
dispatch.earliest_time = -10m
dispatch.latest_time = now
alert.track = 1
description = Detects API or modular input execution errors.

############################
# BLOCK EVENT VOLUME
############################

[ThreatER Block Event Volume Spike]
disabled = 1
alert_type = number
alert_comparator = >
alert_threshold = 1000
cron_schedule = */5 * * * *
search = index=security_threater sourcetype=threater:block_event \
| stats count as event_count
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.track = 1
description = Detects sudden spikes in block event volume.

############################
# UNEXPECTED BLOCKS
############################

[ThreatER Unexpected Blocks Detected]
disabled = 1
alert_type = number
alert_comparator = >
alert_threshold = 0
cron_schedule = */5 * * * *
search = index=security_threater sourcetype=threater:unexpected_block
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.track = 1
description = Detects unexpected block activity.

############################
# ENFORCER HEALTH
############################

[ThreatER Enforcer Status Degraded]
disabled = 1
alert_type = number
alert_comparator = >
alert_threshold = 0
cron_schedule = */10 * * * *
search = index=security_threater sourcetype=threater:enforcer \
| search status!=active
dispatch.earliest_time = -15m
dispatch.latest_time = now
alert.track = 1
description = Triggers if any enforcer reports a non-active state.

############################
# POLICY CHANGE AUDIT
############################

[ThreatER Policy Changes Detected]
disabled = 1
alert_type = number
alert_comparator = >
alert_threshold = 0
cron_schedule = */15 * * * *
search = index=security_threater sourcetype=threater:policy
dispatch.earliest_time = -15m
dispatch.latest_time = now
alert.track = 1
description = Detects policy changes for audit visibility.

############################
# IOC SEARCH ACTIVITY (NON-ALERT)
############################

[ThreatER IOC Search Activity]
disabled = 1
cron_schedule = */15 * * * *
search = index=security_threater sourcetype=threater:ioc_search_request \
| stats count by user
dispatch.earliest_time = -15m
dispatch.latest_time = now
description = Tracks IOC search activity for investigation context.

############################
# ADMIN ACTIVITY (NON-ALERT)
############################

[ThreatER Administrative Activity]
disabled = 1
cron_schedule = */15 * * * *
search = index=security_threater sourcetype=threater:command_log \
| stats count by user
dispatch.earliest_time = -15m
dispatch.latest_time = now
description = Tracks administrative command activity.

###############################################################################
# ThreatER PLATFORM HEALTH ALERTS
###############################################################################

[ThreatER Platform Down]
disabled = 0
alert_type = always
cron_schedule = */2 * * * *
search = index=security_threater sourcetype=threater:health \
| spath status \
| search status!="OK"
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.severity = 1
alert.track = 1
description = Triggers when ThreatER overall platform health is not OK.

###############################################################################

[ThreatER CPU High Utilization]
disabled = 0
alert_type = number
alert_comparator = >
alert_threshold = 85
cron_schedule = */2 * * * *
search = index=security_threater sourcetype=threater:health_cpu \
| spath percent \
| stats latest(percent) as cpu
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.severity = 3
alert.track = 1
description = Triggers when ThreatER CPU utilization exceeds 85 percent.

###############################################################################

[ThreatER Memory High Utilization]
disabled = 0
alert_type = number
alert_comparator = >
alert_threshold = 90
cron_schedule = */2 * * * *
search = index=security_threater sourcetype=threater:health_memory \
| spath percent \
| stats latest(percent) as mem
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.severity = 3
alert.track = 1
description = Triggers when ThreatER memory utilization exceeds 90 percent.

###############################################################################

[ThreatER Backend Service Down]
disabled = 0
alert_type = always
cron_schedule = */2 * * * *
search = index=security_threater sourcetype=threater:health_* \
| spath status \
| search status="DOWN"
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.severity = 2
alert.track = 1
description = Triggers when any ThreatER backend service reports DOWN.

###############################################################################
# END OF FILE
###############################################################################
