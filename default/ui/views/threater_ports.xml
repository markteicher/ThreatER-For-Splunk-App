<form version="1.1">
  <label>Ports</label>

  <search>
    <query>
      index=security_threater sourcetype=threater:port
      | spath
      | eval
          port_lc=lower(tostring(port)),
          protocol_lc=lower(protocol),
          direction_lc=lower(direction),
          enabled_lc=lower(tostring(enabled))
    </query>
  </search>

  <fieldset submitButton="false">
    <input type="text" token="port_filter">
      <label>Port</label>
    </input>

    <input type="dropdown" token="protocol_filter">
      <label>Protocol</label>
      <choice value="*">All</choice>
      <choice value="tcp">TCP</choice>
      <choice value="udp">UDP</choice>
      <default>*</default>
    </input>

    <input type="dropdown" token="direction_filter">
      <label>Direction</label>
      <choice value="*">All</choice>
      <choice value="inbound">Inbound</choice>
      <choice value="outbound">Outbound</choice>
      <default>*</default>
    </input>

    <input type="dropdown" token="enabled_filter">
      <label>Enabled</label>
      <choice value="*">All</choice>
      <choice value="true">Enabled</choice>
      <choice value="false">Disabled</choice>
      <default>*</default>
    </input>
  </fieldset>

  <row>
    <panel>
      <table>
        <title>Configured Ports</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:port
            | spath
            | eval
                port_lc=lower(tostring(port)),
                protocol_lc=lower(protocol),
                direction_lc=lower(direction),
                enabled_lc=lower(tostring(enabled))
            | search
                port_lc="*$port_filter$*"
                protocol_lc="$protocol_filter$"
                direction_lc="$direction_filter$"
                enabled_lc="$enabled_filter$"
            | table
                port
                protocol
                direction
                enabled
                policyCount
                createdDatetime
                updatedDatetime
                uuid
          </query>
        </search>
        <option name="count">25</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <chart>
        <title>Ports by Protocol</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:port
            | spath
            | stats count by protocol
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <chart>
        <title>Enabled vs Disabled Ports</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:port
            | spath
            | stats count by enabled
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>

</form>
