<form version="1.1">
  <label>Health</label>

  <description>
    Real-time health status of ThreatER services and system resources.
  </description>

  <search>
    <query>
      index=security_threater sourcetype=threater:health*
    </query>
    <earliest>-5m</earliest>
    <latest>now</latest>
  </search>

  <row>
    <panel>
      <single>
        <title>Overall Status</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:health
            | spath status
            | eval status=upper(status)
            | stats latest(status) AS status
          </query>
        </search>
        <option name="colorBy">value</option>
        <option name="useColors">true</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xD93F3C"]</option>
        <option name="rangeValues">["OK","DEGRADED","DOWN"]</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <single>
        <title>CPU Utilization (%)</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:health_cpu
            | spath percent
            | stats latest(percent) AS percent
          </query>
        </search>
        <option name="unit">%</option>
        <option name="useColors">true</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xD93F3C"]</option>
        <option name="rangeValues">[70,85]</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>Memory Utilization (%)</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:health_memory
            | spath percent
            | stats latest(percent) AS percent
          </query>
        </search>
        <option name="unit">%</option>
        <option name="useColors">true</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xD93F3C"]</option>
        <option name="rangeValues">[75,90]</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <single>
        <title>SQL</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:health_sql
            | spath status
            | stats latest(status) AS status
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorBy">value</option>
        <option name="rangeColors">["0x65A637","0xD93F3C"]</option>
        <option name="rangeValues">["UP","DOWN"]</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>MongoDB</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:health_mongo
            | spath status
            | stats latest(status) AS status
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorBy">value</option>
        <option name="rangeColors">["0x65A637","0xD93F3C"]</option>
        <option name="rangeValues">["UP","DOWN"]</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>Cassandra</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:health_cassandra
            | spath status
            | stats latest(status) AS status
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorBy">value</option>
        <option name="rangeColors">["0x65A637","0xD93F3C"]</option>
        <option name="rangeValues">["UP","DOWN"]</option>
      </single>
    </panel>
  </row>
</form>
