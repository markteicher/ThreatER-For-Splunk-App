<form version="1.1">
  <label>Users</label>

  <search>
    <query>
      index=security_threater sourcetype=threater:user
      | spath
      | eval
          email_lc=lower(email),
          role_lc=lower(role),
          company_name_lc=lower('company.name'),
          msp_name_lc=lower('company.msp.name'),
          enabled_lc=lower(tostring(enabled))
    </query>
  </search>

  <!-- ========================= -->
  <!-- FILTERS -->
  <!-- ========================= -->
  <fieldset submitButton="false">
    <input type="text" token="email_filter">
      <label>Email</label>
    </input>

    <input type="dropdown" token="role_filter">
      <label>Role</label>
      <choice value="*">All</choice>
      <choice value="admin">Admin</choice>
      <choice value="readonly">Read Only</choice>
      <default>*</default>
    </input>

    <input type="dropdown" token="enabled_filter">
      <label>Enabled</label>
      <choice value="*">All</choice>
      <choice value="true">Enabled</choice>
      <choice value="false">Disabled</choice>
      <default>*</default>
    </input>

    <input type="text" token="company_filter">
      <label>Company</label>
    </input>

    <input type="text" token="msp_filter">
      <label>MSP</label>
    </input>
  </fieldset>

  <!-- ========================= -->
  <!-- USERS TABLE -->
  <!-- ========================= -->
  <row>
    <panel>
      <table>
        <title>Users</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:user
            | spath
            | eval
                email_lc=lower(email),
                role_lc=lower(role),
                company_name_lc=lower('company.name'),
                msp_name_lc=lower('company.msp.name'),
                enabled_lc=lower(tostring(enabled))
            | search
                email_lc="*$email_filter$*"
                role_lc="$role_filter$"
                enabled_lc="$enabled_filter$"
                company_name_lc="*$company_filter$*"
                msp_name_lc="*$msp_filter$*"
            | table
                email
                role
                enabled
                scope
                access
                uuid
                company.name
                company.msp.name
          </query>
        </search>
        <option name="count">20</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ROLE DISTRIBUTION -->
  <!-- ========================= -->
  <row>
    <panel>
      <chart>
        <title>Role Distribution</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:user
            | spath
            | stats count by role
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <!-- ========================= -->
    <!-- DISABLED USER SPOTLIGHT -->
    <!-- ========================= -->
    <panel>
      <single>
        <title>Disabled Users</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:user
            | spath
            | search enabled=false
            | stats count
          </query>
        </search>
      </single>
    </panel>
  </row>

</form>
