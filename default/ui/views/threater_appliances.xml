<form version="1.1">
  <label>Appliances</label>

  <search>
    <query>
      index=security_threater sourcetype=threater:appliance
      | spath
      | eval
          appliance_name=name,
          appliance_uuid=uuid,
          serial=serialNumber,
          status=status,
          network_status=networkStatus,
          chassis=chassis,
          software_version=softwareVersion,
          update_status=updateStatus,
          is_up_to_date=if(isUpToDate=true,"yes","no"),
          throughput=throughputPercent,
          last_seen=lastConnectedDatetime,
          support_end=supportEndsDatetime,
          company_name=company.name,
          msp_name=company.msp.name
      | table
          appliance_name
          appliance_uuid
          serial
          status
          network_status
          chassis
          software_version
          update_status
          is_up_to_date
          throughput
          last_seen
          support_end
          company_name
          msp_name
    </query>
  </search>

  <!-- ========================= -->
  <!-- FILTERS -->
  <!-- ========================= -->
  <fieldset submitButton="false">
    <input type="text" token="name_filter">
      <label>Name</label>
    </input>

    <input type="dropdown" token="status_filter">
      <label>Status</label>
      <choice value="*">All</choice>
      <choice value="active">Active</choice>
      <choice value="inactive">Inactive</choice>
      <choice value="error">Error</choice>
      <default>*</default>
    </input>

    <input type="dropdown" token="network_filter">
      <label>Network Status</label>
      <choice value="*">All</choice>
      <choice value="UP">UP</choice>
      <choice value="DOWN">DOWN</choice>
      <default>*</default>
    </input>

    <input type="dropdown" token="uptodate_filter">
      <label>Up To Date</label>
      <choice value="*">All</choice>
      <choice value="yes">Yes</choice>
      <choice value="no">No</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- ========================= -->
  <!-- APPLIANCE TABLE -->
  <!-- ========================= -->
  <row>
    <panel>
      <table>
        <title>Appliances</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:appliance
            | spath
            | eval
                appliance_name=name,
                appliance_uuid=uuid,
                serial=serialNumber,
                status=status,
                network_status=networkStatus,
                chassis=chassis,
                software_version=softwareVersion,
                update_status=updateStatus,
                is_up_to_date=if(isUpToDate=true,"yes","no"),
                throughput=throughputPercent,
                last_seen=lastConnectedDatetime,
                support_end=supportEndsDatetime,
                company_name=company.name,
                msp_name=company.msp.name
            | search
                appliance_name="*$name_filter$*"
                status="$status_filter$"
                network_status="$network_filter$"
                is_up_to_date="$uptodate_filter$"
            | table
                appliance_name
                status
                network_status
                software_version
                update_status
                is_up_to_date
                throughput
                last_seen
                support_end
                company_name
                msp_name
          </query>
        </search>
        <option name="count">20</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- STATUS DISTRIBUTION -->
  <!-- ========================= -->
  <row>
    <panel>
      <chart>
        <title>Appliance Status Distribution</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:appliance
            | spath
            | stats count by status
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <chart>
        <title>Up-to-Date vs Out-of-Date</title>
        <search>
          <query>
            index=security_threater sourcetype=threater:appliance
            | spath
            | eval state=if(isUpToDate=true,"Up To Date","Out of Date")
            | stats count by state
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>

</form>
