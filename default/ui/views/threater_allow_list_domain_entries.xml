<dashboard version="1.1">
  <label>Allow List â€“ Domain Entries</label>

  <description>
    Domain entries associated with a selected Allow List source.
  </description>

  <!-- ========================= -->
  <!-- CONTEXT -->
  <!-- ========================= -->
  <row>
    <panel>
      <single>
        <title>Allow List UUID</title>
        <search>
          <query>
| makeresults
| eval uuid="$form.list_uuid$"
| table uuid
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ENTRY METRICS -->
  <!-- ========================= -->
  <row>
    <panel>
      <single>
        <title>Total Entries</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain_entry
| search source.uuid="$form.list_uuid$"
| stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Expired Entries</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain_entry
| search source.uuid="$form.list_uuid$"
| eval expired=if(isnotnull(expiresDatetime) AND strptime(expiresDatetime,"%Y-%m-%dT%H:%M:%S") &lt; now(), 1, 0)
| stats sum(expired) AS expired
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ENTRY TABLE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Domain Entries</title>
      <table>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain_entry
| search source.uuid="$form.list_uuid$"
| eval
    inserted=_time,
    expires=expiresDatetime
| table
    id
    domain
    insertedDatetime
    expiresDatetime
| sort domain
          </query>
        </search>

        <option name="count">50</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

</dashboard>
