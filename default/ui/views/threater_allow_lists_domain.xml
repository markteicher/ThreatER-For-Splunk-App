<dashboard version="1.1">
  <label>Allow Lists â€“ Domains</label>

  <description>
    Domain allow list sources configured in ThreatER.
  </description>

  <!-- ========================= -->
  <!-- OVERVIEW PANELS -->
  <!-- ========================= -->
  <row>
    <panel>
      <single>
        <title>Enabled Lists</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain
| stats count(eval(enabled=true)) AS enabled
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Disabled Lists</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain
| stats count(eval(enabled=false)) AS disabled
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Unhealthy Lists</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain
| stats count(eval(isHealthy=false)) AS unhealthy
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- SYNC / UPDATE AGE -->
  <!-- ========================= -->
  <row>
    <panel>
      <chart>
        <title>Last Sync Age (Hours)</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain
| eval sync_age_hours=(now()-strptime(lastSyncDatetime,"%Y-%m-%dT%H:%M:%S"))/3600
| stats avg(sync_age_hours) AS "Average Sync Age (Hours)"
          </query>
        </search>
        <option name="charting.chart">column</option>
      </chart>
    </panel>

    <panel>
      <chart>
        <title>Last Update Age (Hours)</title>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain
| eval update_age_hours=(now()-strptime(lastUpdateDatetime,"%Y-%m-%dT%H:%M:%S"))/3600
| stats avg(update_age_hours) AS "Average Update Age (Hours)"
          </query>
        </search>
        <option name="charting.chart">column</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ALLOW LIST TABLE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Domain Allow Lists</title>
      <table>
        <search>
          <query>
index=security_threater sourcetype=threater:allow_list_domain
| table
    uuid
    name
    enabled
    count
    type
    interval
    lastUpdateDatetime
    lastSyncDatetime
    isPublic
    isHealthy
| sort name
          </query>
        </search>

        <option name="count">25</option>
        <option name="drilldown">row</option>

        <drilldown>
          <link>
            /app/threater/threater_allow_list_domain_entries?form.list_uuid=$row.uuid$
          </link>
        </drilldown>
      </table>
    </panel>
  </row>

</dashboard>
