# default/transforms.conf
# ThreatER for Splunk App
#
# Transforms:
# - Explicit, opt-in usage
# - Safe defaults
# - No uncontrolled mutation
###############################################################################

###############################################################################
# HOST NORMALIZATION (OPTIONAL – INDEX TIME)
###############################################################################

[threater_set_host_from_enforcer]
SOURCE_KEY = _raw
REGEX = "enforcer_name"\s*:\s*"([^"]+)"
FORMAT = host::$1
DEST_KEY = MetaData:Host
WRITE_META = true

[threater_set_host_from_device]
SOURCE_KEY = _raw
REGEX = "device_name"\s*:\s*"([^"]+)"
FORMAT = host::$1
DEST_KEY = MetaData:Host
WRITE_META = true

###############################################################################
# INDEX ROUTING (OPTIONAL – INDEX TIME)
###############################################################################

[threater_route_events]
SOURCE_KEY = MetaData:Sourcetype
REGEX = ^threater:(block_event|unexpected_block)$
FORMAT = index::security_threater_events
DEST_KEY = _MetaData:Index

[threater_route_admin]
SOURCE_KEY = MetaData:Sourcetype
REGEX = ^threater:(command_log|user_activity)$
FORMAT = index::security_threater_admin
DEST_KEY = _MetaData:Index

###############################################################################
# SOURCETYPE HARDENING (DEFENSIVE)
###############################################################################

[threater_force_block_event_sourcetype]
SOURCE_KEY = _raw
REGEX = "event_type"\s*:\s*"block"
FORMAT = sourcetype::threater:block_event
DEST_KEY = MetaData:Sourcetype

###############################################################################
# RAW PAYLOAD SANITIZATION
###############################################################################

[threater_strip_control_chars]
SOURCE_KEY = _raw
REGEX = [\x00-\x08\x0B\x0C\x0E-\x1F]
FORMAT = 
DEST_KEY = _raw

###############################################################################
# SEARCH-TIME FIELD EXTRACTION
###############################################################################

[threater_extract_list_type]
SOURCE_KEY = _raw
REGEX = "type"\s*:\s*"(allow|block|threat)"
FORMAT = list_type::$1

[threater_extract_policy_direction]
SOURCE_KEY = _raw
REGEX = "direction"\s*:\s*"(inbound|outbound)"
FORMAT = policy_direction::$1

###############################################################################
# FALLBACK HOST SAFETY (OPTIONAL – INDEX TIME)
###############################################################################

[threater_default_host]
SOURCE_KEY = MetaData:Host
REGEX = ^$
FORMAT = host::threater
DEST_KEY = MetaData:Host
WRITE_META = true

###############################################################################
# END OF FILE
###############################################################################
